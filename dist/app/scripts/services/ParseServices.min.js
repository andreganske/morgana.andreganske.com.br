"use strict";angular.module("ParseServices",["toaster"]).factory("ParseSDK",function(a,b,c,d){Parse.initialize("co1z3OCpRS8Ue4JBeNRmWsvj2V48sfSym0kxbCmh","JQSS4X7cFaqA9MWlu6K4pGmoN4mFzYC9SmfizSvU");var e={categories:[{name:"eletro",description:"Eletro eletronicos"},{name:"kitchen",description:"Cozinha"},{name:"utilities",description:"Cama, mesa e banho"},{name:"decor",description:"Decoração"},{name:"others",description:"Outros"}],getConfig:function(){var b={},c=Parse.Config.get().then(function(a){b.allowLogin=a.get("allow_login"),b.allowSingin=a.get("allow_singin"),b.useAnalytics=a.get("use_analytics")},function(a){Parse.Analytics.track("error",{code:""+a.code});var c=Parse.Config.current();void 0===c?(b.allowLogin=!1,b.allowSingin=!1,b.useAnalytics=!1):(b.allowLogin=c.get("allowLogin"),b.allowSingin=c.get("allowSingin"),b.useAnalytics=c.get("useAnalytics"))});c.done(function(){a.allowLogin=b.allowLogin?!0:!1,a.allowSingin=b.allowSingin?!0:!1,a.useAnalytics=b.useAnalytics?!0:!1;var c=Parse.User.current();void 0!=c?(a.logged=!0,a.user=c.get("fullname"),a.login=c.get("username"),a.isAdmin=c.get("isAdmin")):a.logged=!1})},validateLoggedUser:function(){var a=Parse.User.current();void 0!=a&&b.path(a.get("isAdmin")?"/admin":"/guest")},login:function(b){return Parse.User.logIn(b.email,b.password,{success:function(b){a.logged=!0,a.user=b.get("fullname"),a.login=b.get("username"),a.isAdmin=b.get("isAdmin")},error:function(a,b){[101,200,201].indexOf(b.code)>-1?($("#login-inputEmail").parent().toggleClass("has-error"),$("#login-inputPass").parent().toggleClass("has-error"),d.pop("error","Oooops","O login ou a senha digitados estão incorretos. Por favor, verifique e tente novamente :)",5e3)):d.pop("error","Oooops","Houve um erro desconhecido. Por favor, tente novamente mais tarde :D",5e3)}})},logout:function(){Parse.User.logOut(),a.logged=!1,a.user="",a.login="",b.path("/"),c.reload()},getCategory:function(a){var b,c=this;return $.each(c.categories,function(c,d){d.name===a&&(b=d)}),b},getProducts:function(a){var b=this,c=new Parse.Query(Parse.Object.extend("Product"));return a.products=[],c.find({success:function(c){$.each(c,function(c,d){var e={};e.id=d.id,e.name=d.get("name"),e.description=d.get("description"),e.category=b.getCategory(d.get("category")),e.available=d.get("available"),e.availableTxt=d.get("available")?"Disponível":"Reservado",a.products.push(e)})},error:function(a){alert("Error: "+a.code+" "+a.message)}})},getGuests:function(a){var b=new Parse.Query(Parse.Object.extend("Guest"));return a.guests=[],b.find({success:function(b){$.each(b,function(b,c){var d={};d.id=c.id,d.name=c.get("name"),d.email=c.get("email"),d.phone=c.get("phone"),d.delivery="personal"===c.get("delivery")?"Pessoalmente":"Via correio",a.guests.push(d)})},error:function(a){alert("Error: "+a.code+" "+a.message)}})},setProductNotAvailable:function(a){var b=Parse.Object.extend("Product"),c=new Parse.Query(b);return c.get(a.id,{success:function(a){return a.set("available",!1),a.save()},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})},saveGuest:function(a,b,c){var d=Parse.Object.extend("Guest"),e=new d,f=this;return e.set("name",a.name),e.set("email",a.email),e.set("phone",a.phone),e.set("delivery",a.delivery),e.set("product",a.item.id),e.save(null,{success:function(d){f.setProductNotAvailable(a.item).done(function(){var d="Obrigado "+a.name+". Agradecemos pelo carinho e até o casamento! ";c.pop("success","Presente confirmado!",d,1e4),f.sendConfirmationEmail(a),b.close()})},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})},createProduct:function(a,b,c){var d=Parse.Object.extend("Product"),e=new d;return e.set("name",a.name),e.set("description",a.description),e.set("category",a.category.name),e.set("available",!0),e.save(null,{success:function(d){var e=a.name+" adicionado a lista de casamento!";c.pop("success","Novo presente cadastrado!",e,5e3),b.close()},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})},editProduct:function(a){var b=Parse.Object.extend("Product"),c=new Parse.Query(b);return c.get(a.selection[0].id,{success:function(b){b.set("name",a.name),b.set("description",a.description),b.set("category",a.category.name),b.save()},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})},deleteProduct:function(a,b){var c=Parse.Object.extend("Product"),d=new Parse.Query(c);$.each(a.selection,function(a,c){d.get(c.id,{success:function(a){a.destroy({success:function(a){var c="O presentes "+a.get("name")+" foi removido com sucesso da lista de casamento!";b.pop("success","Presente removido",c,2e3)},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})})},sendConfirmationEmail:function(a){Parse.Cloud.run("sendConfirmationEmail",{email:a.email,name:a.name,gift:a.item.name},{success:function(a){var b="Email de confirmação enviado com sucesso!";d.pop("success","Email enviado",b,5e3)},error:function(a){alert("Error: "+a.code+" "+a.message)}})}};return e});